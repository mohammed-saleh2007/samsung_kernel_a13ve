name: Build Kernel CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4
    - name: set permissions
      run: sudo chmod +rwx *
    - name: install needed pkgs
      run: sudo apt-get update && sudo apt-get upgrade -y && sudo apt-get install bc flex git ccache automake lzop bison gperf build-essential zip curl zlib1g-dev zlib1g-dev g++-multilib python3-networkx libxml2-utils bzip2 libbz2-dev libbz2-1.0 libghc-bzlib-dev squashfs-tools pngcrush schedtool dpkg-dev liblz4-tool make optipng -y
    - name: run building script 
      run: bash ./build_kernel.sh
    - name: list fils
      run: ls $(pwd)/arch/arm64/boot/
      
    - name: Archive build output
      run: |
        mkdir -p output
        cp  $(pwd)/arch/arm64/boot/Image output/  # Adjust the path to your build output
        tar -czf release.tar.gz output
        cp release.tar.gz output/
              

    - name: Upload files to a GitHub release
      uses: svenstaro/upload-release-action@2.9.0
    - uses: actions/checkout@v3
    - name: Build
      run: cargo build --release
    - name: Upload binaries to release
      uses: svenstaro/upload-release-action@v2
      with:
        repo_token: ${{ secrets.GITHUB_TOKEN }}
        file: ./output/*
        asset_name: release
        tag: ${{ github.ref }}
        overwrite: true
        body: "This is my kernel file 'Image'"
    - name: Upload files to a GitHub release
      uses: svenstaro/upload-release-action@2.9.0

      
            
